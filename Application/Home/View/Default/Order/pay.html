<script src="__Home_JS_STATIC__/jweixin-1.1.0.js" type="text/javascript"></script>
<script src="__Home_JS_STATIC__/cmbcForClient.js" type="text/javascript"></script>

<include file="Public:header" />
<style type="text/css">
hr {
	display: block;
	-webkit-margin-before: 0.5em;
	-webkit-margin-after: 0.5em;
	-webkit-margin-start: auto;
	-webkit-margin-end: auto;
	border-style: inset;
	border-width: 1px;
}

body {
	/*background-color:#eee;*/
	height: auto;
	
}

.pay-money-address {
	/*background-color: white;*/
	/*border-bottom: 1px solid #DEDEDE;*/
	
}

.pay-money-address-right-ready {
	display: table;
	float: right;
	width: 70%;
	height: 100%;
	vertical-align: middle;
	margin-right: 3%;
}

.pay-money-address-right-ready span {
	display: table-cell;
	height: 100%;
	line-height: 100%;
	vertical-align: middle;
	/*color: #E68012;*/
}

.pay-money-goods-information {
	width: 100%;
	height: 130px;
	margin-bottom: 8px;
}

.pay-money-address {
	margin-bottom: 8px;
}

.pay-money-goods-inforrmation-left {
	display: inline-block;
	width: 49.5%;
}

.pay-money-goods-inforrmation-left img {
	display: inline-block;
	width: 95%;
	height: auto;
	margin-top: 10%;
	margin-bottom: 10%;
}

.pay-money-goods-inforrmation-left a {
	display: inline-block;
	text-align: center;
	width: 100%;
}

.fa-map-marker {
	display: block;
	width: 20px;
	position: relative;
	margin-left: 5px;
	top: 3px;
	font-size: 30px;
	/*color: #E68012;*/
}

.fa-weixin {
	margin-left: 5%;
	margin-top: 4.5%;
	/*font-size: 240%;*/
	color: rgb(60, 176, 52); /*绿色*/
	display: inline-block;
}

.fa-check-circle {
	float: right;
	margin-right: 5%;
	margin-top: 5%;
	font-size: 22px;
	/*color: #E68012;*/
	/*font-size: 240%;*/
}

.pay-money-money-information {
	width: 100%;
	font-size: 12px;
	text-align: left;
	margin-top: -20px;
}

.pay-money-money-information span {
	display: inline;
}

.pay-money-goods-inforrmation-right {
	position: absolute;
	top: 0;
	bottom: 0;
	left: 50%;
	right: 50%;
	margin-top: 9%;
}

.pay-money-pay-sure {
	/*background-color: white;*/
	bottom: 0;
	height: 50px;
}

.pay-money-pay-sure p {
	position: absolute;
	width: 60%;
	left: 3%;
	height: 50px;
	display: inline-block;
	line-height: 50px;
	text-align: left;
	/*margin-top: 7%;*/
	/*border-top: 1px solid #dedede;*/
}

.pay-money-pay-sure p span {
	/*color: rgb(233,110,0);*/
	font-size: 18px;
	position: absolute;
}

.pay-money-pay-sure button {
	position: absolute;
	right: 0;
	width: 40%;
	height: 50px;
}

.alone {
	/*color: black;*/
	
}

.one_coin_logo {
	width: 100%;
	height: auto;
	overflower: hidden;
	/*background-color: white;*/
	padding: 10px 0px;
	margin-bottom: 2px;
	/* display: none; */
}

.one_coin_logo img {
	width: 30%;
	display: block;
	margin: 0 auto;
	/*background-color: white;*/
	margin-bottom: 8px;
}

.buy-message {
	width: 100%;
	/*background: white;*/
	margin-top: 8px;
	height: 100px;
	display: table;
	/*border-bottom: 1px solid #dedede;
    border-top:1px solid #dedede ;*/
}

.message-name {
	display: table-cell;
	height: 100%;
	width: 14%;
	font-size: 14px;
	text-align: center;
	vertical-align: top;
	padding-top: 9%;
}

.message-text {
	display: table-cell;
	width: 100%;
	/*background: greenyellow;*/
	vertical-align: top;
	/*height: 92%;*/
	font-size: 14px;
	border: none;
	float: left;
	padding-top: 5%;
	margin-top: 5%;
	margin-bottom: 5%;
	margin-left: -1%;
}

.point-container .point-word {
	padding: 2%;
	height: 50%;
	/* overflow-y: scroll; */
	padding-left: 5%;
	padding-right: 5%;
	width: 90%;
}

.get-address2 {
	display: inline-block;
	width: 70%;
	height: 62%;
	padding-top: 6%;
}

.pay-money-address-right {
	width: 70%;
}

@media ( orientation : landscape) {
	.pay-money-pay-sure {
		position: fixed;
	}
}

.pay-money-weixin-uncheck {
	color: gray;
}
.loading-bg{
	background-color: rgba(0,0,0,0.4);
	border-radius: 5px;
	width: 140px;
	height: 130px;
	top: 30%;
	left: 29%;
}
</style>

<div class="pay-money-container">
	<!--信息-->
	<div class="pay-money-information">
		<!--地址-->
		<php>if($forward['one_coin_enable']){</php>
		<div class="one_coin_logo">
			<img src="__Home_IMG__/zsh2.0/one_coin_logo.png" style="">
		</div>
		<php>}else{</php>
		<div class="pay-money-address">
			<div class="pay-money-address-left">
				<a>送至</a>
			</div>

			<a class="get-address2 getAddress" id="address-show"> <span
				class="pay-money-location-image"> <!--<img src="__Home_IMG__/zsh2.0/pay-money/location.png">-->
					<i class="fa fa-map-marker"></i>
			</span> <span class="pay-money-address-right"> <font
					class='get-address' id="get-address">请填写收货地址</font>
			</span>
			</a>

			<div class="pay-money-address-right-ready get-address getAddress"
				style="display: none" id="get_address">
				<span id='address' data-userName="{$address.name}"
					data-telNumber="{$address.tel}"
					data-postalCode="{$address.post_code}"
					data-nationalCode="{$address.national_code}"
					data-provinceName="{$address.province}"
					data-cityName="{$address.city}" data-countryName="{$address.area}"
					data-detailInfo="{$address.address}"> 
				</span>
				<a href="###" style="line-height: 100%;display: table-cell;vertical-align: middle;"><i class="fa fa-chevron-right" aria-hidden="true" id="address_iconR"></i></a>	
			</div>
			<!-- <div class="pay-money-address-right" id='get-address'>
        <a id="address-show">请填写收货地址</a>
         <p id='address' data-userName="{$address.name}" data-telNumber="{$address.tel}"
                   data-postalCode="{$address.post_code}" data-nationalCode="{$address.national_code}" data-provinceName="{$address.province}"
                   data-cityName="{$address.city}" data-countryName="{$address.area}" data-detailInfo="{$address.address}">
                    <notempty name="address">
                        {$address.name} {$address.tel}</br>
                        {$address.province} {$address.city} {$address.area} {$address.address} {$address.post_code}
                    </notempty>
                </p>

    </div> -->
		</div>
		<php>}</php>

		<!--商品信息-->
		<volist name='stores' id='store'> <volist name='store.list'
			id='product'> <!--商品信息-->
		<div class="pay-money-goods-inforrmation"
			style="background-color: white; margin-bottom: 8px; border-top: 1px solid #dedede; border-bottom: 1px solid #dedede; position: relative;">
			<div class="pay-money-goods-inforrmation-left">
				<a><img src="{$product['p_pic']}" onerror="javascript:this.src='__Home_IMG__/zsh2.0/home/wait.png';"></a>
			</div>
			<div class="pay-money-goods-inforrmation-right">
				<span href="#" class="pay-money-text-top">{$product['p_name']}</span>
				<span href="#" class="pay-money-text-bottom"><span
					class="alone">单价:</span>&nbsp;¥<span class="new-price">{$product['p_price']}</span><font
					class="hide-number-top">&nbsp;数量:<font
						class="pay-money-num-top">{$product.o_quality}</font></font><span
					class="old-price">¥{$product['p_original_price']}</span></span>
				<!--价格-->
				<div class="pay-money-money-information">
					<a>快递:&nbsp;<span class="pay-money-num">¥{$store.shipping_cost|number_format=2}</span>&nbsp;<br />
						<font class="hide-number">数量:<span class="pay-money-num">{$product.o_quality}</span></font>
						<font class='detail-select'>规格:&nbsp;<span
							class="pay-money-num detail-message">{$product.o_specification}</span></font></a>
				</div>
			</div>

		</div>



		</volist> </volist>
	</div>

	<!--支付方式-->
	<div class="row pay-money-pay-style">
		<div class="nav navbar-header pay-money-navbar-header"
			role="navigation" style="<?php if($_SESSION['PLATFORM_CODE']=='MSYHC') { echo 'display:none'; }?>">
			<a class="navbar-brand pay-money-navbar-brand">支付方式</a>
		</div>
		<div class="pay-money-pay-select" style="<?php if($_SESSION['PLATFORM_CODE']=='MSYHC') { echo 'display:none'; }?>">
			<foreach name='payTypeList' item='v'>
			<div class="pay-money-weixin-pay"
				onclick="changeType(this,'{$v['type']}')">
				<!--<img src="__Home_IMG__/zsh2.0/pay-money/weichat.png" class="pay-money-weixin-left">-->
				<img class="fa fa-weixin pay-money-weixin-left" src="__Home_IMG__/zsh2.0/order/{$v['type']}.png"><span>{$v['name']}</span>
				<!--<img src="__Home_IMG__/zsh2.0/pay-money/check.png" class="pay-money-weixin-check" id="weixin-pay">-->
				<if condition='$key eq 0'> <i
					class="fa fa-check-circle pay-money-weixin-check" id="weixin-pay"></i>
				<else /> <i
					class="fa fa-check-circle pay-money-weixin-check pay-money-weixin-uncheck"
					id="weixin-pay"></i> </if>
			</div>		
			</foreach>
<!-- 			<div class="mbank"><img src="__Home_IMG__/zsh2.0/order/cmbc.png"/><span>民生银行</span><i class="fa fa-check-circle" id="mspay"></i></div>
			<div class="zfb"><img src="__Home_IMG__/zsh2.0/order/ali.png" /><span>支付宝</span><i class="fa fa-check-circle" id="zfpay"></i></div>
			<div class="zfb"><img src="__Home_IMG__/zsh2.0/order/weixin.png" /><span>支付宝</span><i class="fa fa-check-circle" id="zfpay"></i></div> -->
		</div>

		<div class="buy-message">
			<span class="message-name">留言:</span>
			<textarea class="message-text" id="message" placeholder="点击这里给卖家留言" rows="4" maxlength="150">{$order_detail['remark']}</textarea>
		</div>

		<div class="empty" style="width: 100%;height: 20px;"></div>
		<!-- <hr/> -->

		<div class="pay-money-pay-sure" id="pay" onclick='onBridgeReady()'>
			<p>
				&nbsp;总价:<span class="pay-money-price">&nbsp;&nbsp;&nbsp;¥{$total_price|number_format=2}</span>
			</p>
			<button >确认支付</button>
		</div>

	</div>
</div>
<div id="iframe-wrap"
	style="position: fixed; left: 0; top: 0; display: none; width: 100%; height: 100%;">
	<iframe id="iframe" src="" frameborder="0" width="100%" height="100%" name='iframeAddress'>
	</iframe>
</div>
<include file='Public:footer' />
<script type="text/javascript" src="__Home_JS_STATIC__/jquery.tmpl.js"></script>

<script type="text/javascript">

			$('.nah i').click(function(){
				if(goback){
		            
		            // $("#iframe-wrap").hide();
		            // $(".pay-money-container").show();
		            // //$(".head-name").html("222");
		            // goback = false;
				}else{
					var platformCode = "{$_SESSION['PLATFORM_CODE']}";
					if ( platformCode == 'MSYHC' ){
						$('.head-name').html('确认订单');
					}else{
						$('title').html('乐天邦 - 确认订单');
						var $body = $('body');
						document.title = '乐天邦 - 确认订单';
						var $iframe = $('<iframe src="/favicon.ico"></iframe>');
						$iframe.on('load',function() {
						  setTimeout(function() {
						      $iframe.off('load').remove();
						  }, 0);
						}).appendTo($body);
					}
					
				}
			});
			
			
	var u = navigator.userAgent;
	var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1;
	//android终端
	var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
	//ios终端
	//alert('是否是Android：'+isAndroid);
	//alert('是否是iOS：'+isiOS);
	if (isAndroid){
		$('.message-name').css('padding-top','9%');
		
	}else{
		$('.message-name').css('padding-top','9.3%');
	}

var ds = $('.detail-message').text();

	if (ds.length > 1) {
		$('.old-price').hide();
		$('.hide-number').hide();
		var s=$('.pay-money-num').css('color');
		$('.pay-money-num-top').css('color',s.toString());

	} else{

		$('.detail-select').hide();
		$('.hide-number-top').hide();
	}

</script>

<script type="text/javascript">

var iframeUrl = "{:U('Order/address')}";
    iframeUrl +='?orderid='+{$order_detail.id}

function showMsg(msg){
    $('#point').show();
    $('#msgInfo').html(msg);
}

    $("#loadingToast").hide();
    window.eType = document.hasOwnProperty("ontouchstart") || window.hasOwnProperty("ontouchstart") ? "touchstart" : "click";
    if($("#address").text().trim()!=""){
        $("#address-show").hide();
    }else{
        //获取最近一次使用的地址
        var getAdressUrl="{:U('Home/Member/getOneAddress')}";
        $(".loading-bg").show();
        $.post(getAdressUrl, {id:"{$_GET['id']}"}, function (jsonData) {
            $(".loading-bg").hide();
            if (jsonData.state==1) {
                var res=jsonData.data;
                var addressData={
                            telNumber: res.tel,
                            userName: res.name,
                            postalCode: res.post_code,
                            nationalCode: res.national_code,
                            provinceName: res.province,
                            cityName: res.city,
                            countryName: res.area,
                            detailInfo: res.address,
                            orderid: '{$order_detail.id}'
                        };
                var arr=[addressData.userName, addressData.telNumber+"</br>", addressData.provinceName, addressData.cityName, addressData.countryName, addressData.postalCode, addressData.detailInfo];
                $("#address").html(arr.join(" ")).data(addressData);
                $("#address-show").hide();
                $("#get_address").show();
                $('.pay-money-location-image').remove();
                $("#addr_id").val(res['id'])

                    iframeUrl +='&id='+res['id']
                $("#iframe").attr('src',iframeUrl)
            } else if (jsonData.state==-1) {
                isDOGet=1;
                $("#login-dropdown").dropdown('toggle');
            } else {

                $("#iframe").attr('src',iframeUrl)

                //$.cl.alert(jsonData.msg);
            }
        }, "json");
    }
    var stores={$stores|json_encode};

    //地址设置
    $(".getAddress").click(function(){

        var is_wx = '{$is_wx}';
        if(is_wx){
            weixinAddress()
        }else{

        	var platformCode = "{$_SESSION['PLATFORM_CODE']}";
        	if ( platformCode == 'MSYHC' ){
        		$('.head-name').html('新增/编辑收货地址');  //确认订单
        	}else {
				var $body = $('body');
				document.title = '乐天邦 - 新增/编辑收货地址';
				
				var $iframe = $('<iframe src="/favicon.ico"></iframe>');
				$iframe.on('load',function() {
				  setTimeout(function() {
				      $iframe.off('load').remove();
				  }, 0);
				}).appendTo($body);
        	}
            $("#iframe-wrap").show();
            $(".pay-money-container").hide();
            goback = true;
        }
    })

    function weixinAddress(){

        wx.ready(function () {
        //获取用户地址
        // $(".getAddress").on(eType,function () {
            wx.openAddress({
                success: function (res) {
                    if (res.errMsg=="openAddress:ok") {
                        
                        var url="{:U('Home/Member/setAddress')}";
                        var telNumber=res.telNumber,
                                userName=res.userName,
                                postalCode=res.postalCode,
                                nationalCode=res.nationalCode,
                                provinceName=res.provinceName,
                                cityName=res.cityName,
                                countryName=res.countryName,
                                detailInfo=res.detailInfo,
                                arr=[userName, telNumber+"</br>", provinceName, cityName, countryName, postalCode, detailInfo];
                        var addressData={
                            telNumber: telNumber,
                            userName: userName,
                            postalCode: postalCode,
                            nationalCode: nationalCode,
                            provinceName: provinceName,
                            cityName: cityName,
                            countryName: countryName,
                            detailInfo: detailInfo,
                            orderid: '{$order_detail.id}'
                        };
                        $("#loadingToast").show();
                        $("#address-show").hide();
                        $("#get_address").show();
                        //随时保存下地址
                        $.post(url, addressData, function (jsonData) {
                            $("#loadingToast").hide();
                            if (jsonData.state==1) {
                                // $("#address").html(arr.join(" ")).data(addressData);
                                // $('.pay-money-location-image').remove();
                                // isDOGet=1;
                                // $("#login-dropdown").dropdown('toggle');
                                addAddressNew(res,0)
                            } else {
                                showMsg(jsonData.msg);
                            }
                        }, "json");
                    } else {
                        showMsg(res.errMsg);
                    }
                },
                fail: function (res) {
                	//用户取消，被调用的也是这段程序，所以注释掉
                	//showMsg('亲，出错了。请稍后再试！');
                	//showMsg( JSON.stringify(res));  
                  },
                cancel: function () {
                    // 用户取消拉出地址
                }
            });
        // });
    });
    }

    function addAddressNew(res,id){


                        var telNumber=res.telNumber,
                                userName=res.userName,
                                postalCode=res.postalCode,
                                nationalCode=res.nationalCode,
                                provinceName=res.provinceName,
                                cityName=res.cityName,
                                countryName=res.countryName,
                                detailInfo=res.detailInfo,
                                arr=[userName, telNumber+"</br>", provinceName, cityName, countryName, postalCode, detailInfo];
                        var addressData={
                            telNumber: telNumber,
                            userName: userName,
                            postalCode: postalCode,
                            nationalCode: nationalCode,
                            provinceName: provinceName,
                            cityName: cityName,
                            countryName: countryName,
                            detailInfo: detailInfo,
                            orderid: '{$order_detail.id}'
                        };
                        $("#address").html(arr.join(" ")).data(addressData);
                        $("#address-show").hide();
                        $("#get_address").show()
                        $('.pay-money-location-image').remove();
                        iframeUrl = "{:U('Order/address')}";
                        iframeUrl +='?orderid='+{$order_detail.id};
                        iframeUrl +='&id='+id
                $("#iframe").attr('src',iframeUrl)
    }
    // wx.ready(function () {
    //     //获取用户地址
    //     $(".getAddress").on(eType,function () {
    //         wx.openAddress({
    //             success: function (res) {
    //                 if (res.errMsg=="openAddress:ok") {
    //                     var url="{:U('Home/Member/setAddress')}";
    //                     var telNumber=res.telNumber,
    //                             userName=res.userName,
    //                             postalCode=res.postalCode,
    //                             nationalCode=res.nationalCode,
    //                             provinceName=res.provinceName,
    //                             cityName=res.cityName,
    //                             countryName=res.countryName,
    //                             detailInfo=res.detailInfo,
    //                             arr=[userName, telNumber+"</br>", provinceName, cityName, countryName, postalCode, detailInfo];
    //                     var addressData={
    //                         telNumber: telNumber,
    //                         userName: userName,
    //                         postalCode: postalCode,
    //                         nationalCode: nationalCode,
    //                         provinceName: provinceName,
    //                         cityName: cityName,
    //                         countryName: countryName,
    //                         detailInfo: detailInfo,
    //                         orderid: '{$order_detail.id}'
    //                     };
    //                     $("#loadingToast").show();
    //                     $("#address-show").hide();
    //                     $("#get_address").show();
    //                     //随时保存下地址
    //                     $.post(url, addressData, function (jsonData) {
    //                         $("#loadingToast").hide();
    //                         if (jsonData.state==1) {
    //                             $("#address").html(arr.join(" ")).data(addressData);
    //                             $('.pay-money-location-image').remove();
    //                         } else if (jsonData.state==-1) {
    //                             isDOGet=1;
    //                             $("#login-dropdown").dropdown('toggle');
    //                         } else {
    //                             showMsg(jsonData.msg);
    //                         }
    //                     }, "json");
    //                 } else {
    //                     showMsg(res.errMsg);
    //                 }
    //             },
    //             cancel: function () {
    //                 // 用户取消拉出地址
    //             }
    //         });
    //     });
    // });
    // if (document.addEventListener) {
    //     document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
    // } else if (document.attachEvent) {
    //     document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
    //     document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
    // }
    // 
var payType = '{$payTypeList[0]['type']}';
var canPay = true;
  function changeType(s,type){

    payType =  type;
    $(".pay-money-pay-select div").each(function(){

         $(this).children('i').eq(0).addClass('pay-money-weixin-uncheck');
    })
    $(s).children('i').eq(0).removeClass('pay-money-weixin-uncheck');

  }
 localStorage.setItem('payError','{$reload}')
    function onBridgeReady() {
    	
        if(!canPay) return false;
        canPay = false;
        //微信支付
        var one_coin_enable = "{$forward['one_coin_enable']}";
       // $("#pay").bind(eType, function () {
            if ($("#address").text().trim()=="" && one_coin_enable==0) {
                showMsg("亲，请先填写收货地址");
                canPay = true;
                return false;
            }
            // if($('#addr_id').val()){
            //    var addrUpdate =  false;
            //    $.ajax({

            //     url:"{:U('Member/updateAddr')}",
            //     data:{order_id:"{$_GET['id']}",addr_id:$('#addr_id').val()},
            //     success:function(data){


            //     }
            //    })

            // }
            $('.loading-bg').show();
            var url  = "{:U('Home/Order/getPrepareData')}";
            $.ajax({

                url:url,
                data:{id:'{$order_detail.id}',payType:payType,remark: $("#message").val()},
                type:'post',
                success:function(data){
$('.loading-bg').hide();
                    if(data.status==1){

                        if(payType =='weixin'){
                         
                         var params  =  eval("("+data['data']+")")
                        WeixinJSBridge.invoke('getBrandWCPayRequest', params, function (res) {
                        if (res.err_msg=="get_brand_wcpay_request:ok") {
                            // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
                            //支付成功 跳回商品详情
                            var product_id;
                            for(var key in stores){
                                var list=stores[key].list;
                                product_id=list[0].p_id;
                            }
                            showMsg('支付成功')
                            setTimeout(function(){

                              //var goUrl="{:U('/Home/Product/view/id/suffix_id')}";
                            //window.location.href=goUrl.replace(/suffix_id/g, product_id);
                            window.location.href = "{$forward['url']}";
                            },2000)
                        }else if(res.err_msg=="get_brand_wcpay_request:cancel"){

                            //showMsg('您已经取消支付')
                        }else {
                           
                            if(localStorage.getItem('payError') == 1){
                            
                                location.href=window.location.href+'?reload=2'
                              
                            }else{

                                  showMsg(JSON.stringify(res.err_msg))
                            }

                        }
                    });
                        }else if(payType=='cmbc'){

                          submitOrderForCash(data['data'])
                        }else if(payType == 'ali'){

                        	$("body").prepend(data['data'])
                        	//console.log(data['data'])
                        }
                    }else{

                        showMsg(data.msg)
                    }
                    canPay = true
                }
        //    })
            // var url="{:U('Home/Order/paySucess')}";
            // var postData={
            //     id: '{$order_detail.id}',
            //     pay_type: 1,
            //     pay_price: '{$total_product_price}',
            //     shipping_cost: '{$total_shipping_cost}',
            //     remark: $("#message").val()
            // };
            // $("#loadingToast").show();
            // //预支付，保存一些订单信息
            // $.post(url, postData, function (jsonData) {

            //     $("#loadingToast").hide();
            //     if (jsonData.state==1) {
            //         //var params={$paySign};
            //         // var params=11;
            //         WeixinJSBridge.invoke('getBrandWCPayRequest', params, function (res) {
            //             if (res.err_msg=="get_brand_wcpay_request:ok") {
            //                 // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
            //                 //支付成功 跳回商品详情
            //                 var product_id;
            //                 for(var key in stores){
            //                     var list=stores[key].list;
            //                     product_id=list[0].p_id;
            //                 }
            //                 showMsg('支付成功')
            //                 setTimeout(function(){

            //                   //var goUrl="{:U('/Home/Product/view/id/suffix_id')}";
            //                 //window.location.href=goUrl.replace(/suffix_id/g, product_id);
            //                 window.location.href = "{$forward['url']}";
            //                 },2000)
            //             }else if(res.err_msg=="get_brand_wcpay_request:cancel"){

            //                 //showMsg('您已经取消支付')
            //             }else {
                           
            //                 if(localStorage.getItem('payError') == 1){
                            
            //                     location.href=window.location.href+'?reload=2'
                              
            //                 }else{

            //                       showMsg(JSON.stringify(res.err_msg))
            //                 }

            //             }
            //         });
            //     } else if (jsonData.state==-1) {
            //         isDOGet=1;
            //         $("#login-dropdown").dropdown('toggle');
            //     } else {
            //         $.cl.alert(jsonData.msg);
            //     }
            // }, "json");
        });
    }
</script>

<!-- 页面定时跳转 -->
<script type="text/javascript">
//3秒钟之后跳转到指定的页面
setTimeout(function(){

    showMsg('支付超时,请重新下单')
    setTimeout(function(){

        window.location.href='/wxzspfse/index.php'
    },3000)
},"{$timeOut}");

</script>
<script type="text/javascript">

	$(function(){
		
		$("#address-show").click(function (){
			// $("#iframe-wrap").show();
		});
		
		
		
	});
	
</script>
<if condition ="$_SESSION['PLATFORM_CODE'] eq 'MSYHC'">
<script type="text/javascript">

	//ios终端
//	alert('是否是Android：'+isAndroid);
//	alert('是否是iOS：'+isiOS);
	var u = navigator.userAgent;
	var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1;
	//android终端
	var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
//	alert('是否是Android：'+isAndroid);
//	alert('是否是iOS：'+isiOS); 
	if (isiOS){ 

		var startx, starty;
	    //获得角度
	    function getAngle(angx, angy) {
	        return Math.atan2(angy, angx) * 180 / Math.PI;
	    };
	 
	    //根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
	    function getDirection(startx, starty, endx, endy) {
	        var angx = endx - startx;
	        var angy = endy - starty;
	        var result = 0;
	 
	        //如果滑动距离太短
	        if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
	            return result;
	        }
	 
	        var angle = getAngle(angx, angy);
	        if (angle >= -135 && angle <= -45) {
	            result = 1;
	        } else if (angle > 45 && angle < 135) {
	            result = 2;
	        } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
	            result = 3;
	        } else if (angle >= -45 && angle <= 45) {
	            result = 4;
	        }
	 
	        return result;
	    }
	    //手指接触屏幕
	    document.addEventListener("touchstart", function(e) {
	        startx = e.touches[0].pageX;
	        starty = e.touches[0].pageY;
	    }, false);
	    //手指离开屏幕
	    document.addEventListener("touchend", function(e) {
	        var endx, endy;
	        endx = e.changedTouches[0].pageX;
	        endy = e.changedTouches[0].pageY;
	        var direction = getDirection(startx, starty, endx, endy);
	        switch (direction) {
	            case 1:
	            	//上滑
//	            	alert(11)
					$("#pay").css("bottom","0");
	                break;
	            case 2:
	                //下滑
//	                alert(22)
	               $("#pay").css("bottom","50px");
	                break;
	            default:
	        }
	    }, false);
	    document.addEventListener("touchmove", function(e) {
	        var endx, endy;
	        endx = e.changedTouches[0].pageX;
	        endy = e.changedTouches[0].pageY;
	        var direction = getDirection(startx, starty, endx, endy);
	        var pay1 = document.querySelector("#pay");
	        switch (direction) {
	           case 1:
	            	//上滑
//	            	alert(11)
					$("#pay").css("bottom","0");
	                break;
	            case 2:
	                //下滑
//	                alert(22)
	               $("#pay").css("bottom","50px");
	                break;
	            default:
	        }
	    }, false);
	} 	
	
		
</script>
</if>
</body>
<script type="text/javascript">
	setInterval(function(){
		$('.nah').css('top','0px')
	},1);
</script>
</html>
